<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Absensi Guru SMAN 1 Maron</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f4ff; margin: 0; padding: 0; text-align: center; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; margin-top: 30px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #aaa; }
        button { padding: 10px 20px; border: none; border-radius: 8px; background: #0057ff; color: white; cursor: pointer; font-size: 16px; }
        button:hover { background: #0040c9; }
        #camera { width: 100%; border-radius: 10px; }
        .guru-card { padding: 15px; background: #e8f0ff; border-radius: 10px; margin-top: 10px; }
        .foto-preview { width: 100%; margin-top: 10px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="container" id="loginBox">
    <h2>Login Absensi Guru</h2>
    <input type="password" id="password" placeholder="Masukkan Password" />
    <button onclick="login()">Masuk</button>
</div>

<div class="container" id="absenBox" style="display:none;">
    <h2>Absensi Guru</h2>
    <input type="text" id="nipInput" placeholder="Masukkan NIP" />
    <button onclick="cariGuru()">Cari Guru</button>

    <div id="guruInfo" class="guru-card" style="display:none;">
        <h3 id="guruNama"></h3>
        <p id="guruNip"></p>
        <img id="guruFoto" src="" width="150" style="border-radius:10px;" />
    </div>

    <video id="camera" autoplay></video>
    <canvas id="siswaCanvas" style="display:none;"></canvas>

    <button id="absenBtn" style="display:none;" onclick="ambilFoto()">Ambil Foto & Simpan Absensi</button>
    <img id="fotoPreview" class="foto-preview" style="display:none;" />

    <p>Waktu Absensi: <span id="checkInText">-</span></p>
</div>

<script>
let dataGuru = {
    "1987654321": { nama: "Budi Santoso", foto: "https://i.ibb.co/2jW5L7M/user.png" },
    "1234567890": { nama: "Siti Aminah", foto: "https://i.ibb.co/2jW5L7M/user.png" }
};

function login() {
    let pw = document.getElementById("password").value;
    if (pw === "GURU SMARON HEBAT") {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("absenBox").style.display = "block";
        startCamera();
    } else {
        alert("Password salah!");
    }
}

function startCamera() {
    let cam = document.getElementById("camera");
    navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
        cam.srcObject = stream;
    });
}

function cariGuru() {
    let nip = document.getElementById("nipInput").value;
    let info = dataGuru[nip];

    if (info) {
        document.getElementById("guruInfo").style.display = "block";
        document.getElementById("guruNama").textContent = info.nama;
        document.getElementById("guruNip").textContent = "NIP: " + nip;
        document.getElementById("guruFoto").src = info.foto;
        document.getElementById("absenBtn").style.display = "block";
    } else {
        alert("NIP tidak ditemukan!");
    }
}

function ambilFoto() {
    let video = document.getElementById("camera");
    let canvas = document.getElementById("siswaCanvas");
    let ctx = canvas.getContext("2d");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0);

    let fotoData = canvas.toDataURL("image/png");
    document.getElementById("fotoPreview").src = fotoData;
    document.getElementById("fotoPreview").style.display = "block";

    let nip = document.getElementById("nipInput").value;
    let nama = dataGuru[nip].nama;
    let waktuSekarang = new Date().toLocaleString();
    document.getElementById("checkInText").textContent = waktuSekarang;

    let absensiData = JSON.parse(localStorage.getItem("absensi")) || [];

    absensiData.push({
        nip: nip,
        nama: nama,
        waktu: waktuSekarang,
        foto: fotoData
    });

    localStorage.setItem("absensi", JSON.stringify(absensiData));

    alert("Absensi berhasil disimpan!");
}
</script>

</body>
</html>
